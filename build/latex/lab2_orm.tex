%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Sonny]{fncychap}
\ChNameVar{\Large\normalfont\sffamily}
\ChTitleVar{\Large\normalfont\sffamily}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{lab2\_orm}
\date{May 25, 2021}
\release{0.0.1}
\author{Yanchao Wang, Jianhao Zhan, Jiawei Tang, Zhiyuan Chen}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{Introduction}
\label{\detokenize{index:introduction}}
\begin{DUlineblock}{0em}
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] In this lab, we are going to learn the object\sphinxhyphen{}relational mapper (ORM) provided by SQLAlchemy.
\end{DUlineblock}
\item[] With ORM, we can map a class to a database table, and map an object of that class to a row in
\item[] the database table. With SQLAlchemy’s ORM, we can avoid directly using any raw SQL statements.
\item[] More important,we will be able to follow the principle of dependency inversion \textendash{} let ORM depend
\item[] on the domain model,but not the other way around.
\item[] 
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] We will create 3 files:
\end{DUlineblock}
\end{DUlineblock}
\begin{itemize}
\item {} 
model.py

\item {} 
orm.py

\item {} 
app.py

\end{itemize}

\begin{DUlineblock}{0em}
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] Here app.py imports the above two python modules and generates an SQLite database exactly
\end{DUlineblock}
\item[] like EnglishPalDatabase.db
\end{DUlineblock}


\chapter{Materials and Methods}
\label{\detokenize{index:materials-and-methods}}

\section{Work Flow}
\label{\detokenize{index:work-flow}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
Review and analyze the requirements in lab2.pdf.

\item {} 
Learn about the relative knowledges in Chapter 2 of the course text book.

\item {} 
Start with the code.

\item {} 
Search for the coding techniques required online.

\item {} 
Finish the coding process.

\item {} 
Summarize and Write the document.

\end{enumerate}


\section{Source Codes}
\label{\detokenize{index:source-codes}}
\begin{DUlineblock}{0em}
\item[]
\begin{DUlineblock}{\DUlineblockindent}
\item[] For this part, We implemented the incomplete function, class and used property to achieve the
\end{DUlineblock}
\item[] requirements. See the source codes and comments for detail.
\end{DUlineblock}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
orm.py

\end{enumerate}
\begin{quote}

\fvset{hllines={, 37, 38, 39, 40, 41, 42, 43, 44, 46, 47, 48, 49, 50, 51,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy} \PYG{k+kn}{import} \PYG{n}{Table}\PYG{p}{,} \PYG{n}{MetaData}\PYG{p}{,} \PYG{n}{Column}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{String}\PYG{p}{,} \PYG{n}{Date}\PYG{p}{,} \PYG{n}{ForeignKey}
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy}\PYG{n+nn}{.}\PYG{n+nn}{orm} \PYG{k+kn}{import} \PYG{n}{mapper}\PYG{p}{,} \PYG{n}{relationship}

\PYG{k+kn}{import} \PYG{n+nn}{model}

\PYG{n}{metadata} \PYG{o}{=} \PYG{n}{MetaData}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{articles} \PYG{o}{=} \PYG{n}{Table}\PYG{p}{(}
   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{articles}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{metadata}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{article\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{autoincrement}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{10000}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{source}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{nullable}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{question}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{1000}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}

\PYG{n}{users} \PYG{o}{=} \PYG{n}{Table}\PYG{p}{(}
   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{users}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{metadata}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{username}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{password}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{64}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{start\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{n}{nullable}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{expiry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{n}{nullable}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}

\PYG{n}{newwords} \PYG{o}{=} \PYG{n}{Table}\PYG{p}{(}
   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{newwords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{metadata}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{word\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{autoincrement}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{username}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ForeignKey}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{users.username}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{word}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} ADDITION: add the reading part}
\PYG{n}{readings} \PYG{o}{=} \PYG{n}{Table}\PYG{p}{(}
   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{readings}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
   \PYG{n}{metadata}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{autoincrement}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{username}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{String}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ForeignKey}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{users.username}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
   \PYG{n}{Column}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{article\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{Integer}\PYG{p}{,} \PYG{n}{ForeignKey}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{articles.article\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{start\PYGZus{}mappers}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
   \PYG{c+c1}{\PYGZsh{} ADDITION: implement the start\PYGZus{}mapper()}
   \PYG{n}{lines\PYGZus{}mapper} \PYG{o}{=} \PYG{n}{mapper}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{,} \PYG{n}{users}\PYG{p}{)}
   \PYG{n}{lines\PYGZus{}mapper} \PYG{o}{=} \PYG{n}{mapper}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{,} \PYG{n}{newwords}\PYG{p}{)}
   \PYG{n}{lines\PYGZus{}mapper} \PYG{o}{=} \PYG{n}{mapper}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{Article}\PYG{p}{,} \PYG{n}{articles}\PYG{p}{)}
   \PYG{n}{lines\PYGZus{}mapper} \PYG{o}{=} \PYG{n}{mapper}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{Reading}\PYG{p}{,}\PYG{n}{readings}\PYG{p}{)}
   \PYG{c+c1}{\PYGZsh{} pass}
\end{sphinxVerbatim}
\sphinxresetverbatimhllines
\end{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{1}
\item {} 
model.py

\end{enumerate}
\begin{quote}

\fvset{hllines={, 2, 3, 6, 7, 8, 9, 10, 38, 39, 40, 41, 42, 43, 45, 46, 47, 48, 49, 50, 51, 52, 55, 56, 57, 58, 59,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{from} \PYG{n+nn}{dataclasses} \PYG{k+kn}{import} \PYG{n}{dataclass}
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy} \PYG{k+kn}{import} \PYG{n}{create\PYGZus{}engine}
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy}\PYG{n+nn}{.}\PYG{n+nn}{orm} \PYG{k+kn}{import} \PYG{n}{sessionmaker}


\PYG{c+c1}{\PYGZsh{} ADDITION: just for convenience}
\PYG{n}{engine} \PYG{o}{=} \PYG{n}{create\PYGZus{}engine}\PYG{p}{(}
   \PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sqlite:///D:}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{newDesktop}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{大三下courses}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{SADP}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{lab2}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{test}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{EnglishPalDatabase.db}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{get\PYGZus{}session} \PYG{o}{=} \PYG{n}{sessionmaker}\PYG{p}{(}\PYG{n}{bind}\PYG{o}{=}\PYG{n}{engine}\PYG{p}{)}
\PYG{n}{session} \PYG{o}{=} \PYG{n}{get\PYGZus{}session}\PYG{p}{(}\PYG{p}{)}

\PYG{n+nd}{@dataclass}
\PYG{k}{class} \PYG{n+nc}{Article}\PYG{p}{:}
   \PYG{n}{article\PYGZus{}id}\PYG{p}{:} \PYG{n+nb}{int}
   \PYG{n}{text}\PYG{p}{:} \PYG{n+nb}{str}
   \PYG{n}{source}\PYG{p}{:} \PYG{n+nb}{str}
   \PYG{n}{date}\PYG{p}{:} \PYG{n+nb}{str}
   \PYG{n}{level}\PYG{p}{:} \PYG{n+nb}{int}
   \PYG{n}{question}\PYG{p}{:} \PYG{n+nb}{str}


\PYG{k}{class} \PYG{n+nc}{NewWord}\PYG{p}{:}
   \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{username}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yyyy\PYGZhy{}mm\PYGZhy{}dd}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{username} \PYG{o}{=} \PYG{n}{username}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{word} \PYG{o}{=} \PYG{n}{word}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{date} \PYG{o}{=} \PYG{n}{date}


\PYG{k}{class} \PYG{n+nc}{User}\PYG{p}{:}
   \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{username}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{start\PYGZus{}date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}19}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{expiry\PYGZus{}date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2031\PYGZhy{}05\PYGZhy{}19}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{username} \PYG{o}{=} \PYG{n}{username}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{password} \PYG{o}{=} \PYG{n}{password}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{start\PYGZus{}date} \PYG{o}{=} \PYG{n}{start\PYGZus{}date}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{expiry\PYGZus{}date} \PYG{o}{=} \PYG{n}{expiry\PYGZus{}date}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{\PYGZus{}read} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

   \PYG{k}{def} \PYG{n+nf}{read\PYGZus{}article}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{article}\PYG{p}{)}\PYG{p}{:}
      \PYG{c+c1}{\PYGZsh{} ADDITION: implement the action}
      \PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{article}\PYG{p}{)}
      \PYG{n}{reading} \PYG{o}{=} \PYG{n}{Reading}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{username}\PYG{p}{,} \PYG{n}{article}\PYG{o}{.}\PYG{n}{article\PYGZus{}id}\PYG{p}{)}
      \PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{reading}\PYG{p}{)}
      \PYG{n}{session}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
      \PYG{c+c1}{\PYGZsh{} pass}

   \PYG{c+c1}{\PYGZsh{} ADDITION: use property to achieve list(user.newwords)}
   \PYG{n+nd}{@property}
   \PYG{k}{def} \PYG{n+nf}{newwords}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
      \PYG{n}{words} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{NewWord}\PYG{p}{)}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{NewWord}\PYG{o}{.}\PYG{n}{username} \PYG{o}{==} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{username}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}
      \PYG{c+c1}{\PYGZsh{} test code}
      \PYG{c+c1}{\PYGZsh{} for w in words:}
      \PYG{c+c1}{\PYGZsh{}     print(w.word)}
      \PYG{k}{return} \PYG{n}{words}


\PYG{c+c1}{\PYGZsh{} ADDITION: implement the Reading class}
\PYG{k}{class} \PYG{n+nc}{Reading}\PYG{p}{:}
   \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{username}\PYG{p}{,} \PYG{n}{article\PYGZus{}id}\PYG{p}{)}\PYG{p}{:}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{username} \PYG{o}{=} \PYG{n}{username}
      \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{article\PYGZus{}id} \PYG{o}{=} \PYG{n}{article\PYGZus{}id}
\end{sphinxVerbatim}
\sphinxresetverbatimhllines
\end{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
app.py

\end{enumerate}
\begin{quote}

\fvset{hllines={, 9,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy} \PYG{k+kn}{import} \PYG{n}{create\PYGZus{}engine}
\PYG{k+kn}{from} \PYG{n+nn}{sqlalchemy}\PYG{n+nn}{.}\PYG{n+nn}{orm} \PYG{k+kn}{import} \PYG{n}{sessionmaker}

\PYG{k+kn}{import} \PYG{n+nn}{model}
\PYG{k+kn}{import} \PYG{n+nn}{orm}

\PYG{n}{orm}\PYG{o}{.}\PYG{n}{start\PYGZus{}mappers}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{engine} \PYG{o}{=} \PYG{n}{create\PYGZus{}engine}\PYG{p}{(}
   \PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sqlite:///D:}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{newDesktop}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{大三下courses}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{SADP}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{lab2}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{test}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{EnglishPalDatabase.db}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} modify the path}
\PYG{n}{orm}\PYG{o}{.}\PYG{n}{metadata}\PYG{o}{.}\PYG{n}{drop\PYGZus{}all}\PYG{p}{(}\PYG{n}{engine}\PYG{p}{)}
\PYG{n}{orm}\PYG{o}{.}\PYG{n}{metadata}\PYG{o}{.}\PYG{n}{create\PYGZus{}all}\PYG{p}{(}\PYG{n}{engine}\PYG{p}{)}
\PYG{n}{get\PYGZus{}session} \PYG{o}{=} \PYG{n}{sessionmaker}\PYG{p}{(}\PYG{n}{bind}\PYG{o}{=}\PYG{n}{engine}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add two users}

\PYG{n}{session} \PYG{o}{=} \PYG{n}{get\PYGZus{}session}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{try}\PYG{p}{:}
   \PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mrlan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{start\PYGZus{}date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}14}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
   \PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lanhui}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Hard2Guess!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{start\PYGZus{}date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
   \PYG{n}{session}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{except}\PYG{p}{:}
   \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Duplicate insertions.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{session}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{)}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{u} \PYG{o+ow}{in} \PYG{n}{session}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
   \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{u}\PYG{o}{.}\PYG{n}{username}\PYG{p}{)}

\PYG{n}{session}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add a few new words}

\PYG{n}{session} \PYG{o}{=} \PYG{n}{get\PYGZus{}session}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lanhui}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{starbucks}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lanhui}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{luckin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lanhui}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{secondcup}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mrlan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{costa}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{NewWord}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mrlan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{word}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{timhortons}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2021\PYGZhy{}05\PYGZhy{}15}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add a few articles}

\PYG{n}{session} \PYG{o}{=} \PYG{n}{get\PYGZus{}session}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{article} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{Article}\PYG{p}{(}\PYG{n}{article\PYGZus{}id}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
                        \PYG{n}{text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{THE ORIGIN OF SPECIES BY MEANS OF NATURAL SELECTION, OR THE PRESERVATION OF FAVOURED RACES IN THE STRUGGLE FOR LIFE}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                        \PYG{n}{source}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CHARLES DARWIN, M.A.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{date}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1859\PYGZhy{}01\PYGZhy{}01}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{level}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
                        \PYG{n}{question}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Are humans descended from monkeys?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{add}\PYG{p}{(}\PYG{n}{article}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} query user and let him read something}

\PYG{n}{session} \PYG{o}{=} \PYG{n}{get\PYGZus{}session}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{user} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{)}\PYG{o}{.}\PYG{n}{filter\PYGZus{}by}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lanhui}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{one}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{item} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{user}\PYG{o}{.}\PYG{n}{newwords}\PYG{p}{)}\PYG{p}{:}
   \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{item}\PYG{o}{.}\PYG{n}{word}\PYG{p}{)}

\PYG{n}{user}\PYG{o}{.}\PYG{n}{read\PYGZus{}article}\PYG{p}{(}\PYG{n}{article}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} this method call will add a row to table readings}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{user} \PYG{o}{=} \PYG{n}{session}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{User}\PYG{p}{)}\PYG{o}{.}\PYG{n}{filter\PYGZus{}by}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mrlan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{one}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{item} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{user}\PYG{o}{.}\PYG{n}{newwords}\PYG{p}{)}\PYG{p}{:}
   \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{item}\PYG{o}{.}\PYG{n}{word}\PYG{p}{)}

\PYG{n}{user}\PYG{o}{.}\PYG{n}{read\PYGZus{}article}\PYG{p}{(}\PYG{n}{article}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} this method call will add a row to table readings}

\PYG{n}{session}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{session}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\sphinxresetverbatimhllines
\end{quote}


\chapter{Results}
\label{\detokenize{index:results}}
For this part we make \sphinxstylestrong{screenshots} to illustrate the results.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
After running \sphinxstylestrong{app.py}:

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{./imgs/apppy_res}.png}

\item {} 
Inside \sphinxstylestrong{EnglishPalDatabase.db(Open with Navicat Premium)}:
\begin{itemize}
\item {} 
list of tables:

\noindent\sphinxincludegraphics[width=200\sphinxpxdimen]{{./imgs/db_tables}.png}

\item {} 
articles:

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{./imgs/db_articles}.png}

\item {} 
newwords:

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{./imgs/db_newwords}.png}

\item {} 
readings:

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{./imgs/db_readings}.png}

\item {} 
users:

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{./imgs/db_users}.png}

\end{itemize}

\end{enumerate}


\chapter{Discussions}
\label{\detokenize{index:discussions}}\begin{itemize}
\item {} 
For this lab we learnt about the way to manipulate database with SQLAlchemy’s ORM (object\sphinxhyphen{}relational mapper) instead of raw SQL statement in web application, which will bring convenience while making the architecture more clear.

\item {} 
We tried to understand dependency inversion.

\item {} 
Also, we learnt to use Read the Docs combining with Sphinx to manage our lab report.

\end{itemize}


\chapter{References}
\label{\detokenize{index:references}}\begin{itemize}
\item {} 
\sphinxhref{http://lanlab.org/course/2021s/softarch/Lab2.pdf}{lab2.pdf}

\end{itemize}



\renewcommand{\indexname}{Index}
\printindex
\end{document}